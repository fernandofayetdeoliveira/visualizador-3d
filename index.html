<script>
    let modeloAtual = null;
    let autoRotate = true;
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xF8F9FC);
    
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(30, 30, 30);
    
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.autoRotate = true; // Usar rotação automática do OrbitControls
    controls.autoRotateSpeed = 2; // Velocidade ajustável
    controls.enableDamping = true; // Suaviza o movimento
    controls.dampingFactor = 0.05;

    // Iluminação (mantido igual)
    scene.add(new THREE.AmbientLight(0xFFFFFF, 0.8));
    const luzDirecional = new THREE.DirectionalLight(0xFFFFFF, 1);
    luzDirecional.position.set(10, 20, 15);
    scene.add(luzDirecional);

    function carregarModelo(caminho) {
        if (modeloAtual) scene.remove(modeloAtual);
        
        new THREE.GLTFLoader().load(caminho, (gltf) => {
            modeloAtual = gltf.scene;
            
            // Centralizar e ajustar câmera
            const box = new THREE.Box3().setFromObject(modeloAtual);
            const center = box.getCenter(new THREE.Vector3());
            modeloAtual.position.sub(center);
            
            scene.add(modeloAtual);
            
            // Atualizar controles
            controls.target.copy(center); // Foco no centro do modelo
            controls.update();
            
            // Ajustar posição da câmera
            const tamanho = box.getSize(new THREE.Vector3()).length();
            camera.position.copy(center).add(new THREE.Vector3(0, 0, tamanho * 2)); // Posição mais lógica
            camera.lookAt(center);
            
        }, undefined, (erro) => {
            console.error('Erro ao carregar:', erro);
        });
    }

    function toggleRotacao() {
        controls.autoRotate = !controls.autoRotate; // Usar o controle nativo
        document.getElementById('toggleRotacao').textContent = 
            controls.autoRotate ? 'Parar Rotação' : 'Iniciar Rotação';
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update(); // Atualiza controles com damping
        renderer.render(scene, camera);
    }
    animate();

    // Carregar primeiro modelo
    carregarModelo('models/teste1.gltf');

    // Redimensionamento responsivo
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
