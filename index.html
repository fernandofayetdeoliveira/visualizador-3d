<!DOCTYPE html>
<html>
<head>
    <title>Visualizador 3D com LDrawLoader</title>
    <style>
        body { margin: 0; }
        #info { position: absolute; top: 10px; left: 10px; color: #444; }
    </style>
</head>
<body>
    <div id="info">three.js - LDrawLoader</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GUI } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/libs/lil-gui.module.min.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { LDrawLoader } from 'three/addons/loaders/LDrawLoader.js';
        import { LDrawUtils } from 'three/addons/utils/LDrawUtils.js';
        import { LDrawConditionalLineMaterial } from 'three/addons/materials/LDrawConditionalLineMaterial.js';

        let camera, scene, renderer, controls, gui;
        let model;

        // Configurações do loader
        const guiData = {
            displayLines: true,
            conditionalLines: true,
            smoothNormals: true,
            flatColors: false,
            mergeModel: false
        };

        init();

        function init() {
            // Configuração da cena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xdeebed);

            // Câmera
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(150, 200, 250);

            // Renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Controles
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // GUI
            createGUI();

            // Carregar modelo
            loadModel('models/seu_modelo.ldr');
        }

        function loadModel(path) {
            const loader = new LDrawLoader();
            loader.setConditionalLineMaterial(LDrawConditionalLineMaterial);
            loader.smoothNormals = guiData.smoothNormals;

            loader.load(path, (model) => {
                if (model) scene.add(model);
                updateObjectsVisibility();
            });
        }

        function updateObjectsVisibility() {
            model.traverse((child) => {
                if (child.isLineSegments) {
                    child.visible = child.isConditionalLine ? guiData.conditionalLines : guiData.displayLines;
                }
            });
        }

        function createGUI() {
            gui = new GUI();
            
            gui.add(guiData, 'displayLines').name('Mostrar Linhas').onChange(updateObjectsVisibility);
            gui.add(guiData, 'conditionalLines').name('Linhas Condicionais').onChange(updateObjectsVisibility);
            gui.add(guiData, 'smoothNormals').name('Normais Suaves').onChange(() => loadModel('models/seu_modelo.ldr'));
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
